<nav aria-label="breadcrumb" style="margin-top: 80px; z-index: 1;">
  <!-- Add z-index: 1 -->
  <ol class="breadcrumb">
    <li class="breadcrumb-item"><a [routerLink]="['/dashboard']">Dashboard</a></li>
    <li class="breadcrumb-item active" aria-current="page">lead List</li>
  </ol>
</nav>

<!-- Toolbar -->
<mat-toolbar color="primary" class="mb-4">
  <span>Lead List</span>
  <span class="spacer"></span>
  <button mat-raised-button color="accent" (click)="openCreateLeadDialog()">
    <mat-icon>add</mat-icon> Create Lead
  </button>
</mat-toolbar>

<div class="container-fluid">
  <!-- Search and Filter Section -->
  <mat-card class="mb-4">
    <mat-card-content>
      <div class="search-filter-container">
        <mat-form-field appearance="outline" class="search-field">
          <mat-label>Search leads...</mat-label>
          <input matInput [(ngModel)]="searchQuery" (input)="filterLeads()">
          <mat-icon matSuffix>search</mat-icon>
        </mat-form-field>

        <mat-form-field appearance="outline" class="filter-field">
          <mat-label>Time Filter</mat-label>
          <mat-select [(ngModel)]="selectedFilter" (selectionChange)="filterLeads()">
            <mat-option value="all">All Time Entries</mat-option>
            <mat-option value="today">Today's Entries</mat-option>
            <mat-option value="last7days">Last 7 Days</mat-option>
            <mat-option value="last1month">Last 1 Month</mat-option>
          </mat-select>
        </mat-form-field>

        <div class="view-toggle">
          <button mat-icon-button [color]="displayMode === 'list' ? 'primary' : ''" (click)="toggleView('list')">
            <mat-icon>view_list</mat-icon>
          </button>
          <button mat-icon-button [color]="displayMode === 'grid' ? 'primary' : ''" (click)="toggleView('grid')">
            <mat-icon>grid_view</mat-icon>
          </button>
        </div>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- List View -->
  <div *ngIf="displayMode === 'list'" class="list-view">
    <mat-card *ngFor="let lead of paginatedLeads" class="lead-item">
      <mat-card-content>
        <div class="lead-content">
          <div class="lead-info">
            <img [src]="lead.imageUrl" alt="Lead Image" class="lead-avatar">
            <div class="lead-details">
              <h3>{{ lead.name }}</h3>
              <div class="detail-item">
                <mat-icon>email</mat-icon>
                <span>{{ lead.email }}</span>
              </div>
              <div class="detail-item">
                <mat-icon>phone</mat-icon>
                <span>{{ lead.phone }}</span>
              </div>
              <div class="detail-item">
                <mat-icon>source</mat-icon>
                <span>{{ lead.leadSource }}</span>
              </div>
              <div class="detail-item">
                <mat-icon>category</mat-icon>
                <span>{{ lead.leadType }}</span>
              </div>
            </div>
          </div>
          <div class="lead-actions">
            <button mat-raised-button color="primary" (click)="viewDetails(lead)">
              <mat-icon>visibility</mat-icon> View
            </button>
            <button mat-raised-button color="accent" (click)="openFollowUpDialog(lead)">
              <mat-icon>event</mat-icon> Follow Up
            </button>
            <button mat-raised-button color="warn" (click)="deleteLead(lead.id)">
              <mat-icon>delete</mat-icon> Delete
            </button>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Grid View -->
  <div *ngIf="displayMode === 'grid'" class="grid-view">
    <div class="grid-container">
      <mat-card *ngFor="let lead of paginatedLeads" class="lead-card">
        <div class="lead-avatar-container">
          <img [src]="lead.imageUrl" alt="Lead Image" class="lead-avatar">
          <h3 class="lead-name">{{ lead.name }}</h3>
        </div>
        <mat-card-content>
          <div class="lead-info-grid">
            <div class="info-item">
              <mat-icon>email</mat-icon>
              <span>{{ lead.email }}</span>
            </div>
            <div class="info-item">
              <mat-icon>phone</mat-icon>
              <span>{{ lead.phone }}</span>
            </div>
            <div class="info-item">
              <mat-icon>source</mat-icon>
              <span>{{ lead.leadSource }}</span>
            </div>
            <div class="info-item">
              <mat-icon>category</mat-icon>
              <span>{{ lead.leadType }}</span>
            </div>
          </div>
        </mat-card-content>
        <mat-divider></mat-divider>
        <mat-card-actions>
          <button mat-button color="accent" (click)="openFollowUpDialog(lead)">
            Follow Up
          </button>
          <button mat-button color="primary" (click)="viewDetails(lead)">
            View
          </button>
          <button mat-button color="warn" (click)="deleteLead(lead.id)">
            Delete
          </button>
        </mat-card-actions>
      </mat-card>
    </div>
  </div>

  <!-- Pagination -->
  <mat-paginator
    [length]="filteredLeads.length"
    [pageSize]="pageSize"
    [pageSizeOptions]="[10, 20, 50, 100]"
    (page)="onPageChange($event)"
    aria-label="Select page">
  </mat-paginator>
</div>

<!-- Lead Details Dialog -->
<ng-template #leadDetailsDialog>
  <h2 mat-dialog-title>Lead Details</h2>
  <mat-dialog-content>
    <div *ngIf="selectedLead" class="lead-details">
      <p><strong>Name:</strong> {{ selectedLead.name }}</p>
      <p><strong>Email:</strong> {{ selectedLead.email }}</p>
      <p><strong>Phone:</strong> {{ selectedLead.phone }}</p>
      <p><strong>Lead Source:</strong> {{ selectedLead.leadSource }}</p>
      <p><strong>Lead Type:</strong> {{ selectedLead.leadType }}</p>
      <p><strong>Company:</strong> {{ selectedLead.company }}</p>
      <p><strong>Status:</strong> {{ selectedLead.status }}</p>
      <p><strong>Created Date:</strong> {{ selectedLead.createdDate }}</p>
      <p><strong>Notes:</strong> {{ selectedLead.notes }}</p>
    </div>
  </mat-dialog-content>
  <mat-dialog-actions align="end">
    <button mat-button mat-dialog-close>Close</button>
  </mat-dialog-actions>
</ng-template>

<!-- Create Lead Dialog -->
<ng-template #createLeadDialog>
  <h2 mat-dialog-title>Create Lead</h2>
  <mat-dialog-content>
    <form [formGroup]="leadForm">
      <div class="form-row">
        <mat-form-field appearance="outline">
          <mat-label>Name</mat-label>
          <input matInput formControlName="name" required>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Number</mat-label>
          <input matInput formControlName="number" required>
        </mat-form-field>
      </div>

      <div class="form-row">
        <mat-form-field appearance="outline">
          <mat-label>Email</mat-label>
          <input matInput formControlName="email" required>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Assign To</mat-label>
          <mat-select formControlName="assignedTo">
            <mat-option *ngFor="let user of users" [value]="user">
              {{ user }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>

      <div class="form-row">
        <mat-form-field appearance="outline">
          <mat-label>Lead Type</mat-label>
          <mat-select formControlName="leadType">
            <mat-option *ngFor="let type of leadTypes" [value]="type">
              {{ type }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Lead Source</mat-label>
          <mat-select formControlName="leadSource">
            <mat-option value="Reference">Reference</mat-option>
            <mat-option value="India Mart">India Mart</mat-option>
            <mat-option value="LinkedIn">LinkedIn</mat-option>
          </mat-select>
        </mat-form-field>
      </div>

      <div class="form-row">
        <mat-form-field appearance="outline">
          <mat-label>Company</mat-label>
          <input matInput formControlName="company">
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Notes</mat-label>
          <textarea matInput formControlName="notes" rows="3"></textarea>
        </mat-form-field>
      </div>

      <div class="file-upload">
        <button mat-raised-button type="button" (click)="fileInput.click()">
          <mat-icon>attach_file</mat-icon> Attach Documents
        </button>
        <input #fileInput type="file" (change)="onFileSelect($event)" style="display: none">
      </div>
    </form>
  </mat-dialog-content>
  <mat-dialog-actions align="end">
    <button mat-button mat-dialog-close>Cancel</button>
    <button mat-raised-button color="primary" (click)="createLead()">Save Lead</button>
  </mat-dialog-actions>
</ng-template>

<!-- Follow-up Dialog -->
<ng-template #followUpDialog>
    <h2 mat-dialog-title>Schedule Follow-up</h2>
    <mat-dialog-content>
        <div class="lead-details">
            <div class="form-row">
                <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Lead Name</mat-label>
                    <input matInput [(ngModel)]="followUpData.leadName" readonly>
                </mat-form-field>
            </div>

            <div class="form-row">
                <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Status</mat-label>
                    <mat-select [(ngModel)]="followUpData.status">
                        <mat-option value="Call">Call</mat-option>
                        <mat-option value="Email">Email</mat-option>
                        <mat-option value="Meeting">Meeting</mat-option>
                        <mat-option value="Other">Other</mat-option>
                    </mat-select>
                </mat-form-field>
            </div>

            <div class="form-row">
                <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Next Follow-up Date</mat-label>
                    <input matInput type="date" [(ngModel)]="followUpData.nextFollowUpDate">
                </mat-form-field>
            </div>

            <div class="form-row">
                <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Comments</mat-label>
                    <textarea matInput rows="3" [(ngModel)]="followUpData.comments"></textarea>
                </mat-form-field>
            </div>

            <div class="form-row">
                <mat-checkbox [(ngModel)]="followUpData.isMeetingScheduled" (change)="onStatusChange()">
                    Meeting Scheduled
                </mat-checkbox>
            </div>

            <div class="form-row" *ngIf="followUpData.isMeetingScheduled">
                <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Meeting Platform</mat-label>
                    <mat-select [(ngModel)]="followUpData.meetingPlatform">
                        <mat-option value="Google Meet">Google Meet</mat-option>
                        <mat-option value="Zoom">Zoom</mat-option>
                        <mat-option value="Microsoft Teams">Microsoft Teams</mat-option>
                        <mat-option value="Other">Other</mat-option>
                    </mat-select>
                </mat-form-field>
            </div>

            <div class="form-row" *ngIf="followUpData.isMeetingScheduled">
                <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Meeting Link</mat-label>
                    <input matInput [(ngModel)]="followUpData.meetingLink">
                </mat-form-field>
            </div>

            <div class="form-row">
                <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Assigned To</mat-label>
                    <mat-select [(ngModel)]="followUpData.assignedTo">
                        <mat-option *ngFor="let user of users" [value]="user">{{user}}</mat-option>
                    </mat-select>
                </mat-form-field>
            </div>

            <div class="form-row">
                <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Lead Type</mat-label>
                    <mat-select [(ngModel)]="followUpData.leadType">
                        <mat-option *ngFor="let type of leadTypes" [value]="type">{{type}}</mat-option>
                    </mat-select>
                </mat-form-field>
            </div>
        </div>
    </mat-dialog-content>
    <mat-dialog-actions align="end">
        <button mat-button mat-dialog-close>Cancel</button>
        <button mat-raised-button color="primary" (click)="saveFollowUp()">Save Follow-up</button>
    </mat-dialog-actions>
</ng-template>