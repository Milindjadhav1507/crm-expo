<div class="grid-container">
  <!-- Left Section: List of Leads (4 columns) -->
  <div class="lead-list">
    <h2>Leads</h2>

    <!-- Search Input and Status Dropdown -->
    <div class="filter-section">
      <input
        type="text"
        [(ngModel)]="searchQuery"
        (input)="onSearchChange()"
        placeholder="Search by name..."
      />

      <select [(ngModel)]="statusFilter" (change)="onStatusChange()">
        <option *ngFor="let status of statusOptions" [value]="status">
          {{ status }}
        </option>
      </select>
    </div>

    <!-- Lead List as Cards -->
    <div class="card-list">
      <mat-card 
        *ngFor="let lead of filteredLeads"
        class="lead-card"
        (click)="onSelectLead(lead)"
        [class.selected]="lead === selectedLead"
      >
        <div class="card-content">
          <!-- Image Section -->
          <div class="image-section">
            <img [src]="lead.imageUrl" alt="{{ lead.name }}" class="avatar" />
          </div>

          <!-- Details Section -->
          <div class="details-section" style="margin: 10px;">
            <h6 class="lead-name" style="font-size: 20px; margin-top: 5px;">{{ lead.name }}</h6>
            <p class="lead-detail"><strong>Email:</strong> {{ lead.email }}</p>
            <p class="lead-detail"><strong>Phone:</strong> {{ lead.phone }}</p>
            <p class="lead-detail">
              <strong>Lead Source:</strong> {{ lead.leadSource }}
            </p>
            <p class="lead-detail">
              <strong>Lead Type:</strong> {{ lead.leadType }}
            </p>
          </div>
        </div>
      </mat-card>
    </div>
  </div>

  <!-- Right Section: Lead Details (8 columns) -->
  <div class="lead-details" *ngIf="selectedLead" style="margin-top: 80px;">
    <!-- Header Section with Follow Up Button -->
    <div class="header-section">
      <h2>Lead Details</h2>
      <button mat-raised-button color="primary" (click)="openFollowUpModal(selectedLead)" style="margin-left: 900px;">
        Follow Up
      </button>
      <button mat-raised-button color="accent" (click)="openEditModal(selectedLead)" style="margin-left: 8px;">
        Edit
      </button>
    </div>
  
    <!-- Basic Lead Details -->
    <mat-card class="detail-card">
      <mat-card-content>
        <mat-list>
          <!-- Name -->
          <mat-list-item>
            <span matListItemTitle><strong>Name:</strong></span>
            <span matListItemLine>{{ selectedLead.name }}</span>
          </mat-list-item>
  
          <!-- Email -->
          <mat-list-item>
            <span matListItemTitle><strong>Email:</strong></span>
            <span matListItemLine>{{ selectedLead.email }}</span>
          </mat-list-item>
  
          <!-- Phone -->
          <mat-list-item>
            <span matListItemTitle><strong>Phone:</strong></span>
            <span matListItemLine>{{ selectedLead.phone }}</span>
          </mat-list-item>
  
          <!-- Lead Source -->
          <mat-list-item>
            <span matListItemTitle><strong>Lead Source:</strong></span>
            <span matListItemLine>{{ selectedLead.leadSource }}</span>
          </mat-list-item>
  
          <!-- Lead Type -->
          <mat-list-item>
            <span matListItemTitle><strong>Lead Type:</strong></span>
            <span matListItemLine>{{ selectedLead.leadType }}</span>
          </mat-list-item>
  
          <!-- Company -->
          <mat-list-item>
            <span matListItemTitle><strong>Company:</strong></span>
            <span matListItemLine>{{ selectedLead.company }}</span>
          </mat-list-item>
  
          <!-- Status -->
          <mat-list-item>
            <span matListItemTitle><strong>Status:</strong></span>
            <span matListItemLine>{{ selectedLead.status }}</span>
          </mat-list-item>
  
          <!-- Created Date -->
          <mat-list-item>
            <span matListItemTitle><strong>Created Date:</strong></span>
            <span matListItemLine>{{ selectedLead.createdDate }}</span>
          </mat-list-item>
  
          <!-- Notes -->
          <mat-list-item>
            <span matListItemTitle><strong>Notes:</strong></span>
            <span matListItemLine>{{ selectedLead.notes }}</span>
          </mat-list-item>
        </mat-list>
      </mat-card-content>
    </mat-card>
  
    <!-- History of Conversations -->
    <div class="history-section">
      <h3>History of Conversations</h3>
  
      <!-- Status Changes -->
      <mat-card class="history-card" *ngFor="let statusChange of selectedLead.statusHistory">
        <mat-card-header>
          <mat-card-title>Status Change</mat-card-title>
          <mat-card-subtitle>{{ statusChange.date }}</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <p><strong>From:</strong> {{ statusChange.from }}</p>
          <p><strong>To:</strong> {{ statusChange.to }}</p>
          <p><strong>Assigned To:</strong> {{ statusChange.assignedTo }}</p>
        </mat-card-content>
      </mat-card>
  
      <!-- Document Uploads -->
      <mat-card class="history-card" *ngFor="let document of selectedLead.documents">
        <mat-card-header>
          <mat-card-title>Document Uploaded</mat-card-title>
          <mat-card-subtitle>{{ document.date }}</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <p><strong>File Name:</strong> {{ document.fileName }}</p>
          <p><strong>Uploaded By:</strong> {{ document.uploadedBy }}</p>
          <a [href]="document.fileUrl" target="_blank">View Document</a>
        </mat-card-content>
      </mat-card>
  
      <!-- Comments -->
      <mat-card class="history-card" *ngFor="let comment of selectedLead.comments">
        <mat-card-header>
          <mat-card-title>Comment</mat-card-title>
          <mat-card-subtitle>{{ comment.date }}</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <p><strong>By:</strong> {{ comment.by }}</p>
          <p>{{ comment.text }}</p>
        </mat-card-content>
      </mat-card>
    </div>
  </div>
</div>

<!-- Edit Modal Template -->
<ng-template #editModal>
  <h2 mat-dialog-title>Edit Lead</h2>
  <mat-dialog-content>
    <form [formGroup]="editForm">
      <mat-form-field appearance="fill">
        <mat-label>Name</mat-label>
        <input matInput formControlName="name" />
      </mat-form-field>

      <mat-form-field appearance="fill">
        <mat-label>Email</mat-label>
        <input matInput formControlName="email" />
      </mat-form-field>

      <mat-form-field appearance="fill">
        <mat-label>Phone</mat-label>
        <input matInput formControlName="phone" />
      </mat-form-field>

      <mat-form-field appearance="fill">
        <mat-label>Company</mat-label>
        <input matInput formControlName="company" />
      </mat-form-field>

      <mat-form-field appearance="fill">
        <mat-label>Status</mat-label>
        <mat-select formControlName="status">
          <mat-option *ngFor="let status of statusOptions" [value]="status">
            {{ status }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </form>
  </mat-dialog-content>
  <mat-dialog-actions>
    <button mat-button (click)="onCancelEdit()">Cancel</button>
    <button mat-button color="primary" (click)="onSaveEdit()">Save</button>
  </mat-dialog-actions>
</ng-template>

<!-- Follow-Up Modal Template -->
<ng-template #followUpModal>
  <h2 mat-dialog-title>Follow Up</h2>
  <mat-dialog-content>
    <form (submit)="saveFollowUp()">
      <!-- Lead Name (Auto-populated) -->
      <div class="mb-2">
        <label class="form-label">Lead Name</label>
        <input type="text" class="form-control" [(ngModel)]="followUpData.leadName" [ngModelOptions]="{standalone: true}" readonly>
      </div>

      <!-- Follow Up Status -->
      <div class="mb-2">
        <label class="form-label">Follow Up Status <span class="text-danger">*</span></label>
        <select class="form-select" [(ngModel)]="followUpData.status" [ngModelOptions]="{standalone: true}">
          <option value="Closed">Closed</option>
          <option value="Contacted">Contacted</option>
          <option value="Converted">Converted</option>
          <option value="Lost">Lost</option>
          <option value="Open">Open</option>
          <option value="Qualified">Qualified</option>
        </select>
      </div>

      <!-- Next Follow-Up Date (Date Picker) -->
      <div class="mb-2">
        <label class="form-label">Next Follow-Up Date <span class="text-danger">*</span></label>
        <input type="date" class="form-control" [(ngModel)]="followUpData.nextFollowUpDate" [ngModelOptions]="{standalone: true}">
      </div>

      <!-- Comments -->
      <div class="mb-2">
        <label class="form-label">Comments</label>
        <textarea class="form-control" rows="3" [(ngModel)]="followUpData.comments" [ngModelOptions]="{standalone: true}"></textarea>
      </div>

      <!-- Toggle Button for Meeting Fields -->
      <div class="mb-2">
        <label class="form-label">Schedule Meeting?</label>
        <div class="form-check form-switch">
          <input class="form-check-input" type="checkbox" [(ngModel)]="followUpData.isMeetingScheduled" [ngModelOptions]="{standalone: true}" id="meetingToggle">
          <label class="form-check-label" for="meetingToggle">Toggle to schedule a meeting</label>
        </div>
      </div>

      <!-- Meeting Platform (Conditional) -->
      <div class="mb-2" *ngIf="followUpData.isMeetingScheduled">
        <label class="form-label">Meeting Platform</label>
        <select class="form-select" [(ngModel)]="followUpData.meetingPlatform" [ngModelOptions]="{standalone: true}">
          <option value="Google Meet">Google Meet</option>
          <option value="Zoom">Zoom</option>
          <option value="Microsoft Teams">Microsoft Teams</option>
        </select>
      </div>

      <!-- Meeting Link (Conditional) -->
      <div class="mb-2" *ngIf="followUpData.isMeetingScheduled">
        <label class="form-label">Meeting Link</label>
        <input type="url" class="form-control" [(ngModel)]="followUpData.meetingLink" [ngModelOptions]="{standalone: true}">
      </div>

      <div class="text-end mt-3">
        <button mat-raised-button color="primary" type="submit" style="margin: 20px;">
          Create Follow Up
        </button>
        <button mat-stroked-button color="warn" type="button" (click)="onCancelFollowUp()">
          Cancel
        </button>
      </div>
    </form>
  </mat-dialog-content>
</ng-template>